<div class="container-fluid solicitud-analisis">
<div class="row">
<div class="span6 well">
<legend>Solicitud de analisis</legend>
<script type="text/x-handlebars">
{{#if AnalysisSelectedController.selectedItem}}
  {{#view AnalysisCreatedView}}
    <div class="control-group">
      <label class="control-label" >Nombre de Solicitante:</label>
      <label class="control-label" >{{content.applicant_name}}}</label>
    </div>
    <div class="control-group">
      <label class="control-label" >Nombre de medico</label>
      <label class="control-label" >{{content.medic_name}}}</label>
    </div>
    <div class="control-group ">
      <label class="control-label" for="selectError">Seleccione el especialidad</label>
      <div class="controls">
        <select id="especialidad">
          <option></option>
          <?php foreach($this->especialidades as $especialidad){ ?>
            <option value="<?php echo $especialidad->id; ?>"><?php echo $especialidad->name; ?></option>         
          <?php } ?>
        </select>
      </div>
    </div>
    <div class="control-group">
      <label class="control-label" for="selectError">Seleccione el estudio</label>
      <div class="controls">
        <input class="input-xlarge"  id="estudio_name" value="" type="text" >
      </div>
    </div>  
    <div class="form-actions">
      <button type="submit" class="btn btn-danger" {{action Delete}} ><i class="icon-trash icon-white"></i>Eliminar</button>      
    </div>
  {{/view}}
{{else}}
  {{#view AnalysisNewView}}
    <div class="control-group">
      <label class="control-label" for="contact_name">Nombre de Solicitante</label>
      <div class="controls">
        <input class="input-xlarge focused" id="contact_name" value="" type="text">
      </div>
    </div>
    <div class="control-group">
      <label class="control-label" for="medico_name">Nombre de medico</label>
      <div class="controls">
        <input class="input-xlarge" id="medico_name" type="text">
      </div>
    </div>  
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" {{action CreateNew}} >Guardar</button>      
    </div>
  {{/view}}
{{/if}}
</script>​
<!--<form class=" form-search">
 
          <div class="control-group">
            <label class="control-label" for="focusedInput">Nombre de Solicitante</label>
            <div class="controls">
              <input class="input-xlarge focused" id="contact_name" value="" type="text">
              
              
            </div>
          </div>
 
          <div class="control-group">
            <label class="control-label" for="medico_name">Nombre de medico</label>
            <div class="controls">
              <input class="input-xlarge" id="" type="text">
            </div>
            
          </div>
          <div class="control-group ">
            <label class="control-label" for="selectError">Seleccione el especialidad</label>
            <div class="controls">
              <select id="especialidad">
                <option></option>
                <?php foreach($this->especialidades as $especialidad){ ?>
                  <option value="<?php echo $especialidad->id; ?>"><?php echo $especialidad->name; ?></option          
                <?php } ?>
              </select>
            </div>
          </div>
            <div class="control-group">
            <label class="control-label" for="selectError">Seleccione el estudio</label>
            <div class="controls">
              <input class="input-xlarge"  id="estudio_name" value="" type="text" >
            
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button class="btn">Cancel</button>
          </div>
         </form>-->
</div>
<div class="span6 well content-catalogo-prueba"><legend>Catalogo de pruebas</legend>
<script type="text/x-handlebars">
<table class="table table-striped">
  <thead>
  <tr>
    <th>Nombre</th>
    <th>Descripcion</th>
    <th></th>
  </tr>
  </thead>
  <tbody>
    {{#each AppAnalysis.pruebasController}}
        {{#view AppAnalysis.PruebaListView pruebaBinding="this"}}
            <td>{{prueba.name}}</td>
            <td >{{prueba.description}}
            <td><button class="btn btn-success" {{action SelectedItem}} ><i class="icon-plus-sign icon-white"></i></button></td>
        {{/view}}
    {{/each}}
  </tbody>
</table>
</script>​
</div>
</div>
<div class="row">
<div class="span12 well"><legend>Pruebas a realizar</legend>

<script type="text/x-handlebars">
<table class="table table-striped">
  <thead>
  <tr>
    <th>Nombre</th>
    <th>Val. Referencia</th>
    <th>Unidad</th>
    <th></th>
  </tr>
  </thead>
  <tbody>
    {{#each ResultsController}}
        {{#view ResultsListView resultBinding="this"}}
            <td>{{result.item_name}}</td>
            <td >{{result.ref_val_value}}</td>
            <td >{{result.ref_val_unit}}</td>
            <td><button class="btn btn-danger" {{action Remove}} ><i class="icon-trash icon-white"></i></button></td>
        {{/view}}
    {{/each}}
  </tbody>
</table>
</script>​

</div>
</div>
</div>

<script type="text/javascript">
/*window.customInitFunctions = window.customInitFunctions || [];
window.customInitFunctions.push(function(){
  var cache = {},
    lastXhr,
    $contactName = $('#contact_name');

    $contactName.autocomplete({
      minLength: 2,
      source: function( request, response ) {
        var term = request.term;
        if ( term in cache ) {
          response( cache[ term ] );
          return;
        }
        console.log(request);
        lastXhr = $.getJSON( "/contact/list-json", {    
          title: "Paciente",
          first_name__like : "%"+term + "%",
          last_name__like__or : "%"+term + "%"
        }, function( data, status, xhr ) {
          cache[ term ] = data;
          if ( xhr === lastXhr ) {
            response( data.result );
          }
        });
      },
      focus: function( event, ui ) {
        $contactName.val( ui.item.first_name + " " + ui.item.last_name);
        return false;
      },
      select: function( event, ui ) {
        $contactName.val( ui.item.first_name + " " + ui.item.last_name);
        ContactsController.set( "content", [] );
        ContactsController.addObject(Contact.create(ui.item));
        return false;
      }
    })
    .data( "autocomplete" )._renderItem = function( ul, item ) {
      return $( "<li></li>" )
        .data( "item.autocomplete", item )
        .append( "<a>" + item.first_name + " " + item.last_name +"</a>" )
        .appendTo( ul );
    };
  });

  window.customInitFunctions.push(function(){
    var cache = {},
      lastXhr,
      $medicoName = $('#medico_name');

      $medicoName.autocomplete({
        minLength: 2,
        source: function( request, response ) {
          var term = request.term;
          if ( term in cache ) {
            response( cache[ term ] );
            return;
          }                      
          lastXhr = $.getJSON( "/contact/list-json", {    
            title: "Medico",
            first_name__like : "%"+term + "%",
            last_name__like__or : "%"+term + "%"
          }, function( data, status, xhr ) {
            cache[ term ] = data;
            if ( xhr === lastXhr ) {
              response( data.result );
            }
          });
        },
        focus: function( event, ui ) {
          $medicoName.val( ui.item.first_name + " " + ui.item.last_name);
          return false;
        },
        select: function( event, ui ) {
          $medicoName.val( ui.item.first_name + " " + ui.item.last_name);
          MedicosController.set( "content", [] );
          MedicosController.addObject(Contact.create(ui.item));
          return false;
        }
      })
      .data( "autocomplete" )._renderItem = function( ul, item ) {
        return $( "<li></li>" )
          .data( "item.autocomplete", item )
          .append( "<a>" + item.first_name + " " + item.last_name +"</a>" )
          .appendTo( ul );
      };
  });

window.customInitFunctions.push(
  function(){

    var cache = {},
    lastXhr;
    $('#especialidad').on('change', function(){
      cache = {};
    });
    $('#estudio_name').autocomplete({
      minLength: 2,
      source: function( request, response ) {
        var term = request.term;
        if ( term in cache ) {
          response( cache[ term ] );
          return;
        }
        console.log(request);
        lastXhr = $.getJSON( "/tests/list-json", {
          specialty_id: $("#especialidad").val(),
          name__like : "%"+term + "%"
        }, function( data, status, xhr ) {
          cache[ term ] = data;
          if ( xhr === lastXhr ) {
            response( data.result );
          }
        });
      },
      focus: function( event, ui ) {
        $( "#estudio_name" ).val( ui.item.name );
        return false;
      },
      select: function( event, ui ) {
        $( "#estudio_name" ).val( ui.item.name );
        console.log(ui.item.id);
        AppAnalysis.pruebasController.getBy({"test_id": ui.item.id});
        return false;
      }
    })
    .data( "autocomplete" )._renderItem = function( ul, item ) {
      return $( "<li></li>" )
        .data( "item.autocomplete", item )
        .append( "<a>" + item.name +"</a>" )
        .appendTo( ul );
    };

  }
);*/
</script>